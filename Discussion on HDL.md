# HDL设计探讨

### 现有设计

#### 1. SV

- 优点：
  - 部分提供了语法
    - struct/bundle
    - always_comb/always_ff
  - 与verilog完全兼容
- 缺点：
  - 无代码可综合性检测
    - 对于可综合的代码，亦难以进行逻辑分析
  - function功能薄弱
  - 存在陷阱
    - 语法混乱（旧式verilog与sv）
    - 使用高级语法时难以看出综合电路结构



#### 2. Chisel-Like

- 优点：
  - 另起炉灶，排除语法陷阱
  - 语法本身设计较优（scala的部分优点？）
  - 导出时使用最简语法
  - 良好的生态和优化
- 缺点：
  - 工具集难以使用（主要指sbt）
  - java系语言的一些通病
  - 强类型不适用于硬件设计
    - 应当根据wire的使用方法来判断类型，而非根据类型判断使用方法
  - bundle使用仍有困难
    - 不支持现场构造bundle，如{a[20], b[12]} = {c[16], d[16]}
  - 对于再赋值处理薄弱
    - a = a & b应当解读为a' = a, a = a' & b



#### 3. 我们需要什么样的HDL

- 主要功能
  - wire级鸭子类型
    - 在uint的基础上根据使用方法来判断类型 
    - 但是在语法层面依然提供强类型，主要区分硬件和不可综合部分
  - 简化语法（特别是初始化）
    - RegInit(VecInit(Seq.fill(DEPTH)(0.U(DATA_WIDTH.W))))
    - 其实可以写成类似RegInit(array\<depth\>(UINT(0, dw)))
  - 智能重命名
    - 对某一pin再次赋值，构造新的pin，旧pin变为explicit
  - bundle互联
    - 语法级支持直接顺序连接
    - 使用特殊函数可以支持同名wire智能互联
    - 不区分array\<Pin\>和Pin[]，可以按顺序直接互联（本质上为先按序构造两个bundle，然后交叉互联）
    - 自动分析方向（可以手工标注，使用<=, <>, =>运算符）
- 附加功能
  - 初级时序分析
    - 计算逻辑级数并预测时序延迟
  - 状态机语法糖
    - 定义专用库
  - 电路设计优化